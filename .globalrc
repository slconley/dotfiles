# shellcheck shell=bash

# ------------------------------------------------------------
# PREFSHELL selection
# ------------------------------------------------------------
export PREFSHELL=${PREFSHELL:=zsh}
[ "$PREFSHELL" = "bash" ] && [ -z "$BASH" ] && which bash >/dev/null 2>&1 && exec bash
[ "$PREFSHELL" = "zsh"  ] && [ -z "$ZSH_NAME" ] && which zsh >/dev/null 2>&1 && exec zsh

# ----------------------------------------------------------------------------------------------------
# the purpose of this reexec is to ensure consistent use of preferred zsh binary (based on new PATH)
# it is best that this be done as early as possible
# ----------------------------------------------------------------------------------------------------
[ "$ZSH_REEXEC" ] || { export ZSH_REEXEC=done; exec zsh; }

HOST=${HOST:=${HOSTNAME}}; HOST=${HOST%%.*}
[[ $HOST = ip-* ]] && HOST="$(hostnamectl 2>/dev/null | grep Pretty | cut -d: -f2 | cut -c2-)"
NICK=${HOST}; [[ -f ~/.nickname ]] && NICK=$(cat "~/.nickname")

HIST_DTG="$(/bin/date '+%Y%m')"
HISTDIR=~/.var/hist/$NICK; [ -d "$HISTDIR" ] || mkdir -p $HISTDIR
HISTFILE=$HISTDIR/sh.histfile.${HIST_DTG}
HISTFILE_GLOBAL=~/.var/hist/.global/sh.histfile

LOGDIR=~/.var/log/$NICK; [ -d "$LOGDIR" ]

XDG_CONFIG_HOME=~/.files/xdg
XDG_RUNTIME_DIR=~/.run/$NICK

OSNAME="$(uname -s)"
OSREL="$(uname -r)"
OS="$OSNAME$OSREL"
SHELL=${commands[zsh]:-${BASH}}
TEMP=$XDG_RUNTIME_DIR/tmp
TMPDIR=$TEMP
VSC_TMP=$XDG_RUNTIME_DIR/vsc; [ -d "$VSC_TMP" ]

SCREENDIR=$XDG_RUNTIME_DIR/screen; [ -d $SCREENDIR ] || { mkdir -p $SCREENDIR; chmod 700 $SCREENDIR; }
PROFILES=~/.files/profile.d
LPROFILES=~/.local/profile.d

export HIST_DTG HISTDIR HISTFILE HISTFILE_GLOBAL HOST LOGDIR NICK OSNAME OSREL OSTYPE OS 
export SCREENDIR SHELL TEMP TMPDIR XDG_CONFIG_HOME XDG_RUNTIME_DIR VSC_TMP
export LPROFILES PROFILES 

# vi:filetype=zsh

